--[[ 
    JOBWARE LIBRARY - MOBILE OPTIMIZED 
    Based on Neverlose Style
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local JobwareLib = {}

-[span_0](start_span)- Design-Einstellungen aus deiner Vorlage[span_0](end_span)
local Theme = {
	Background = Color3.fromRGB(22, 22, 22),       -- Dunkler Main Background
	Sidebar    = Color3.fromRGB(18, 18, 20),       -- Sidebar etwas dunkler
	Section    = Color3.fromRGB(28, 28, 32),       -- Sektionen heller
	Accent     = Color3.fromRGB(0, 172, 255),      -- Das typische Neverlose-Blau
	Text       = Color3.fromRGB(255, 255, 255),
	TextDim    = Color3.fromRGB(150, 150, 160),
	Outline    = Color3.fromRGB(40, 40, 45)
}

-- Utility: Runde Ecken erstellen
local function AddCorner(instance, radius)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, radius)
	corner.Parent = instance
	return corner
end

-[span_1](start_span)- Utility: Drag Funktion (Mobile Friendly)[span_1](end_span)
local function MakeDraggable(topbar, mainFrame)
	local dragging, dragInput, dragStart, startPos

	topbar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = mainFrame.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)

	topbar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

function JobwareLib:CreateWindow(hubName)
	local Window = {}
	
	-- ScreenGui Setup
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "JobwareUI"
	ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
	ScreenGui.ResetOnSpawn = false
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

	-- Main Frame
	local MainFrame = Instance.new("Frame")
	MainFrame.Name = "MainFrame"
	MainFrame.Size = UDim2.new(0.6, 0, 0.55, 0) -- Gute Größe für Handy Landscape
	MainFrame.Position = UDim2.new(0.2, 0, 0.225, 0)
	MainFrame.BackgroundColor3 = Theme.Background
	MainFrame.BorderSizePixel = 0
	MainFrame.ClipsDescendants = true
	MainFrame.Parent = ScreenGui
	AddCorner(MainFrame, 8)
	
	-- TopBar (Draggable)
	local TopBar = Instance.new("Frame")
	TopBar.Size = UDim2.new(1, 0, 0.1, 0)
	TopBar.BackgroundColor3 = Theme.Sidebar
	TopBar.BorderSizePixel = 0
	TopBar.Parent = MainFrame
	MakeDraggable(TopBar, MainFrame)
	
	-- Titel Text
	local Title = Instance.new("TextLabel")
	Title.Text = hubName or "JOBWARE"
	Title.Font = Enum.Font.GothamBlack
	Title.TextSize = 16
	Title.TextColor3 = Theme.Accent
	Title.BackgroundTransparency = 1
	Title.Size = UDim2.new(0.5, 0, 1, 0)
	Title.Position = UDim2.new(0.05, 0, 0, 0)
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Parent = TopBar

	-- Close Button (Toggle UI)
	local CloseBtn = Instance.new("ImageButton")
	CloseBtn.Size = UDim2.new(0, 25, 0, 25)
	CloseBtn.Position = UDim2.new(0.92, 0, 0.5, 0)
	CloseBtn.AnchorPoint = Vector2.new(0, 0.5)
	CloseBtn.BackgroundColor3 = Color3.new(0,0,0)
	CloseBtn.BackgroundTransparency = 0.5
	CloseBtn.Image = "rbxassetid://3926305904" -- Close Icon
	CloseBtn.ImageRectOffset = Vector2.new(284, 4)
	CloseBtn.ImageRectSize = Vector2.new(24, 24)
	CloseBtn.Parent = TopBar
	AddCorner(CloseBtn, 4)
	
	CloseBtn.MouseButton1Click:Connect(function()
		ScreenGui.Enabled = not ScreenGui.Enabled
	end)

	-- Sidebar (Tabs)
	local Sidebar = Instance.new("ScrollingFrame")
	Sidebar.Size = UDim2.new(0.25, 0, 0.9, 0)
	Sidebar.Position = UDim2.new(0, 0, 0.1, 0)
	Sidebar.BackgroundColor3 = Theme.Sidebar
	Sidebar.BorderSizePixel = 0
	Sidebar.ScrollBarThickness = 0
	Sidebar.Parent = MainFrame
	
	local SideLayout = Instance.new("UIListLayout")
	SideLayout.Padding = UDim.new(0, 5)
	SideLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	SideLayout.SortOrder = Enum.SortOrder.LayoutOrder
	SideLayout.Parent = Sidebar
	
	local SidePad = Instance.new("UIPadding")
	SidePad.PaddingTop = UDim.new(0, 10)
	SidePad.Parent = Sidebar

	-- Content Area (Wo die Sektionen hinkommen)
	local ContentArea = Instance.new("Frame")
	ContentArea.Size = UDim2.new(0.75, 0, 0.9, 0)
	ContentArea.Position = UDim2.new(0.25, 0, 0.1, 0)
	ContentArea.BackgroundTransparency = 1
	ContentArea.Parent = MainFrame

	local Tabs = {}
	local first = true

	-- TABS ERSTELLEN
	function Window:CreateTab(name, iconId)
		local Tab = {}
		
		-- 1. Sidebar Button
		local TabBtn = Instance.new("TextButton")
		TabBtn.Size = UDim2.new(0.9, 0, 0, 35)
		TabBtn.BackgroundColor3 = Theme.Background
		TabBtn.BackgroundTransparency = 1
		TabBtn.Text = name
		TabBtn.Font = Enum.Font.GothamBold
		TabBtn.TextSize = 12
		TabBtn.TextColor3 = Theme.TextDim
		TabBtn.Parent = Sidebar
		AddCorner(TabBtn, 6)
		
		-- 2. Page (Container für Sektionen)
		local Page = Instance.new("ScrollingFrame")
		Page.Size = UDim2.new(1, 0, 1, 0)
		Page.BackgroundTransparency = 1
		Page.Visible = false
		Page.ScrollBarThickness = 3
		Page.ScrollBarImageColor3 = Theme.Accent
		Page.CanvasSize = UDim2.new(0,0,0,0) 
		Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
		Page.Parent = ContentArea
		
		local PageLayout = Instance.new("UIListLayout")
		PageLayout.Padding = UDim.new(0, 12)
		PageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
		PageLayout.Parent = Page
		
		local PagePad = Instance.new("UIPadding")
		PagePad.PaddingTop = UDim.new(0, 10)
		PagePad.PaddingBottom = UDim.new(0, 10)
		PagePad.Parent = Page

		-- Tab Switching Logic
		if first then
			TabBtn.TextColor3 = Theme.Text
			Page.Visible = true
			first = false
		end

		TabBtn.MouseButton1Click:Connect(function()
			-- Alle Tabs resetten
			for _, t in pairs(Tabs) do
				t.Page.Visible = false
				TweenService:Create(t.Btn, TweenInfo.new(0.2), {TextColor3 = Theme.TextDim, BackgroundTransparency = 1}):Play()
			end
			-- Aktiven Tab hervorheben
			Page.Visible = true
			TweenService:Create(TabBtn, TweenInfo.new(0.2), {TextColor3 = Theme.Text, BackgroundTransparency = 0.9}):Play()
		end)

		table.insert(Tabs, {Btn = TabBtn, Page = Page})

		-[span_2](start_span)- SEKTIONEN ERSTELLEN[span_2](end_span)
		function Tab:CreateSection(secName)
			local Section = {}
			
			local SecFrame = Instance.new("Frame")
			SecFrame.Size = UDim2.new(0.95, 0, 0, 0) -- Auto Height
			SecFrame.BackgroundColor3 = Theme.Section
			SecFrame.AutomaticSize = Enum.AutomaticSize.Y
			SecFrame.Parent = Page
			AddCorner(SecFrame, 6)
			
			-[span_3](start_span)- Outline Effekt[span_3](end_span)
			local Stroke = Instance.new("UIStroke")
			Stroke.Color = Theme.Outline
			Stroke.Thickness = 1
			Stroke.Parent = SecFrame
			
			local SecTitle = Instance.new("TextLabel")
			SecTitle.Text = secName
			SecTitle.Size = UDim2.new(1, -20, 0, 25)
			SecTitle.Position = UDim2.new(0, 10, 0, 2)
			SecTitle.BackgroundTransparency = 1
			SecTitle.Font = Enum.Font.GothamBold
			SecTitle.TextSize = 11
			SecTitle.TextColor3 = Theme.Accent -- Accent Farbe für Titel
			SecTitle.TextXAlignment = Enum.TextXAlignment.Left
			SecTitle.Parent = SecFrame
			
			local Container = Instance.new("Frame")
			Container.Size = UDim2.new(1, 0, 0, 0)
			Container.Position = UDim2.new(0, 0, 0, 30) -- Platz für Titel lassen
			Container.BackgroundTransparency = 1
			Container.AutomaticSize = Enum.AutomaticSize.Y
			Container.Parent = SecFrame
			
			local ContainerLayout = Instance.new("UIListLayout")
			ContainerLayout.Padding = UDim.new(0, 6)
			ContainerLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
			ContainerLayout.SortOrder = Enum.SortOrder.LayoutOrder
			ContainerLayout.Parent = Container
			
			local ContainerPad = Instance.new("UIPadding")
			ContainerPad.PaddingBottom = UDim.new(0, 10)
			ContainerPad.Parent = Container
			
			-- [[ ELEMENT: BUTTON ]] --
			function Section:AddButton(text, callback)
				local BtnFunc = {}
				local Button = Instance.new("TextButton")
				Button.Size = UDim2.new(0.9, 0, 0, 30)
				Button.BackgroundColor3 = Theme.Background
				Button.Text = text
				Button.TextColor3 = Theme.Text
				Button.Font = Enum.Font.GothamSemibold
				Button.TextSize = 12
				Button.Parent = Container
				AddCorner(Button, 4)
				
				local BtnStroke = Instance.new("UIStroke")
				BtnStroke.Color = Theme.Outline
				BtnStroke.Thickness = 1
				BtnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
				BtnStroke.Parent = Button
				
				Button.MouseButton1Click:Connect(function()
					-- Kleiner Klick-Effekt
					TweenService:Create(Button, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Accent}):Play()
					task.wait(0.1)
					TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Background}):Play()
					pcall(callback)
				end)
			end

			-[span_4](start_span)- [[ ELEMENT: TOGGLE ]][span_4](end_span)
			function Section:AddToggle(text, default, callback)
				local Toggled = default or false
				
				local ToggleFrame = Instance.new("TextButton") -- Button damit man überall klicken kann
				ToggleFrame.Size = UDim2.new(0.9, 0, 0, 30)
				ToggleFrame.BackgroundColor3 = Theme.Background
				ToggleFrame.Text = ""
				ToggleFrame.AutoButtonColor = false
				ToggleFrame.Parent = Container
				AddCorner(ToggleFrame, 4)
				
				local Label = Instance.new("TextLabel")
				Label.Text = text
				Label.Size = UDim2.new(0.7, 0, 1, 0)
				Label.Position = UDim2.new(0.05, 0, 0, 0)
				Label.BackgroundTransparency = 1
				Label.TextColor3 = Theme.Text
				Label.Font = Enum.Font.GothamSemibold
				Label.TextSize = 12
				Label.TextXAlignment = Enum.TextXAlignment.Left
				Label.Parent = ToggleFrame
				
				-- Der Schalter (Switch)
				local SwitchBg = Instance.new("Frame")
				SwitchBg.Size = UDim2.new(0, 36, 0, 18)
				SwitchBg.Position = UDim2.new(0.95, -36, 0.5, -9)
				SwitchBg.BackgroundColor3 = Toggled and Theme.Accent or Color3.fromRGB(50,50,50)
				SwitchBg.Parent = ToggleFrame
				AddCorner(SwitchBg, 9)
				
				local Circle = Instance.new("Frame")
				Circle.Size = UDim2.new(0, 14, 0, 14)
				-- Wenn an: rechts, Wenn aus: links
				Circle.Position = Toggled and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
				Circle.BackgroundColor3 = Color3.fromRGB(255,255,255)
				Circle.Parent = SwitchBg
				AddCorner(Circle, 7)
				
				local function UpdateToggle()
					Toggled = not Toggled
					local targetPos = Toggled and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
					local targetColor = Toggled and Theme.Accent or Color3.fromRGB(50,50,50)
					
					TweenService:Create(Circle, TweenInfo.new(0.2), {Position = targetPos}):Play()
					TweenService:Create(SwitchBg, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
					
					pcall(callback, Toggled)
				end
				
				ToggleFrame.MouseButton1Click:Connect(UpdateToggle)
			end
			
			-[span_5](start_span)- [[ ELEMENT: SLIDER ]][span_5](end_span)
			function Section:AddSlider(text, min, max, default, callback)
				local SliderVal = default or min
				local dragging = false
				
				local SliderFrame = Instance.new("Frame")
				SliderFrame.Size = UDim2.new(0.9, 0, 0, 45)
				SliderFrame.BackgroundColor3 = Theme.Background
				SliderFrame.Parent = Container
				AddCorner(SliderFrame, 4)
				
				local Label = Instance.new("TextLabel")
				Label.Text = text
				Label.Size = UDim2.new(1, -10, 0, 20)
				Label.Position = UDim2.new(0, 10, 0, 0)
				Label.BackgroundTransparency = 1
				Label.TextColor3 = Theme.Text
				Label.Font = Enum.Font.GothamSemibold
				Label.TextSize = 12
				Label.TextXAlignment = Enum.TextXAlignment.Left
				Label.Parent = SliderFrame
				
				local ValLabel = Instance.new("TextLabel")
				ValLabel.Text = tostring(SliderVal)
				ValLabel.Size = UDim2.new(0, 30, 0, 20)
				ValLabel.Position = UDim2.new(1, -35, 0, 0)
				ValLabel.BackgroundTransparency = 1
				ValLabel.TextColor3 = Theme.Accent
				ValLabel.Font = Enum.Font.GothamBold
				ValLabel.TextSize = 12
				ValLabel.Parent = SliderFrame
				
				-- Die Slider Leiste
				local Bar = Instance.new("TextButton") -- Button zum Klicken
				Bar.Text = ""
				Bar.AutoButtonColor = false
				Bar.Size = UDim2.new(0.9, 0, 0, 6)
				Bar.Position = UDim2.new(0.05, 0, 0.7, 0)
				Bar.BackgroundColor3 = Color3.fromRGB(40,40,40)
				Bar.Parent = SliderFrame
				AddCorner(Bar, 3)
				
				local Fill = Instance.new("Frame")
				Fill.Size = UDim2.new((SliderVal - min) / (max - min), 0, 1, 0)
				Fill.BackgroundColor3 = Theme.Accent
				Fill.Parent = Bar
				AddCorner(Fill, 3)
				
				local function UpdateSlider(input)
					local pos = UDim2.new(math.clamp((input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1), 0, 1, 0)
					Fill.Size = pos
					
					local newVal = math.floor(min + ((max - min) * pos.X.Scale))
					ValLabel.Text = tostring(newVal)
					pcall(callback, newVal)
				end
				
				Bar.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						dragging = true
						UpdateSlider(input)
					end
				end)
				
				UserInputService.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						dragging = false
					end
				end)
				
				UserInputService.InputChanged:Connect(function(input)
					if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
						UpdateSlider(input)
					end
				end)
			end

			return Section
		end
		
		return Tab
	end
	
	return Window
end

return JobwareLib
