--[[ 
    JOBWARE LIBRARY V3 - NEVERLOSE/ONETAP MOBILE STYLE
    Optimized for readability, touch size, and aesthetic.
]]

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")

local JobwareLib = {}

-- [[ CONFIG & THEME ]] --
local Theme = {
	MainBg      = Color3.fromRGB(15, 15, 20),      -- Tiefes Dunkelblau/Schwarz
	SidebarBg   = Color3.fromRGB(10, 10, 15),      -- Dunklere Sidebar
	SectionBg   = Color3.fromRGB(22, 22, 28),      -- Sektions-Hintergrund
	ElementBg   = Color3.fromRGB(35, 35, 42),      -- Hintergrund für Slider/Inputs
	Accent      = Color3.fromRGB(60, 130, 255),    -- "Neverlose" Hellblau
	Text        = Color3.fromRGB(240, 240, 240),   -- Helles Weiß
	TextDark    = Color3.fromRGB(140, 140, 150),   -- Ausgegrauter Text
	Outline     = Color3.fromRGB(50, 50, 60),      -- Feine Ränder
	Font        = Enum.Font.GothamBold             -- Dicker, technischer Font
}

-- [[ HELPER FUNCTIONS ]] --
local function AddCorner(instance, radius)
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, radius)
	corner.Parent = instance
	return corner
end

local function AddStroke(instance, color, thickness)
	local stroke = Instance.new("UIStroke")
	stroke.Color = color or Theme.Outline
	stroke.Thickness = thickness or 1
	stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	stroke.Parent = instance
	return stroke
end

local function MakeDraggable(trigger, object)
	local dragging, dragInput, dragStart, startPos
	trigger.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = object.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	trigger.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			object.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- [[ MAIN WINDOW LOGIC ]] --
function JobwareLib:CreateWindow(hubName)
	local Library = {}
	
	-- Cleanup old UI
	if CoreGui:FindFirstChild("JobwareV3") then CoreGui.JobwareV3:Destroy() end
	
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "JobwareV3"
	ScreenGui.Parent = CoreGui
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	ScreenGui.ResetOnSpawn = false

	-- MOBILE TOGGLE BUTTON (Der kleine Button zum Öffnen/Schließen)
	local ToggleBtnFrame = Instance.new("Frame")
	ToggleBtnFrame.Name = "MobileToggle"
	ToggleBtnFrame.Size = UDim2.new(0, 50, 0, 50)
	ToggleBtnFrame.Position = UDim2.new(0.1, 0, 0.1, 0) -- Oben links start
	ToggleBtnFrame.BackgroundColor3 = Theme.MainBg
	ToggleBtnFrame.Parent = ScreenGui
	AddCorner(ToggleBtnFrame, 25) -- Macht es rund
	AddStroke(ToggleBtnFrame, Theme.Accent, 2)
	MakeDraggable(ToggleBtnFrame, ToggleBtnFrame) -- Button selbst ist verschiebbar
	
	local ToggleIcon = Instance.new("ImageButton")
	ToggleIcon.Size = UDim2.new(0.6, 0, 0.6, 0)
	ToggleIcon.Position = UDim2.new(0.2, 0, 0.2, 0)
	ToggleIcon.BackgroundTransparency = 1
	ToggleIcon.Image = "rbxassetid://13350795660" -- Cheat Logo Icon
	ToggleIcon.ImageColor3 = Theme.Accent
	ToggleIcon.Parent = ToggleBtnFrame
	
	-- MAIN FRAME (Das eigentliche Menü)
	local MainFrame = Instance.new("Frame")
	MainFrame.Name = "MainFrame"
	MainFrame.Size = UDim2.new(0.65, 0, 0.65, 0) -- GRÖSSER ALS VORHER
	MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	MainFrame.BackgroundColor3 = Theme.MainBg
	MainFrame.BorderSizePixel = 0
	MainFrame.Visible = false -- Startet unsichtbar (man muss erst Toggle drücken)
	MainFrame.Parent = ScreenGui
	AddCorner(MainFrame, 6)
	AddStroke(MainFrame, Theme.Outline, 1.5)
	
	-- Toggle Funktion verbinden
	ToggleIcon.MouseButton1Click:Connect(function()
		MainFrame.Visible = not MainFrame.Visible
	end)

	-- TOP BAR (Accent Line + Title)
	local TopBar = Instance.new("Frame")
	TopBar.Size = UDim2.new(1, 0, 0, 35)
	TopBar.BackgroundColor3 = Theme.SidebarBg
	TopBar.BorderSizePixel = 0
	TopBar.Parent = MainFrame
	AddCorner(TopBar, 6)
	
	-- Fix für runde Ecken unten
	local TopBarFill = Instance.new("Frame")
	TopBarFill.Size = UDim2.new(1, 0, 0.5, 0)
	TopBarFill.Position = UDim2.new(0, 0, 0.5, 0)
	TopBarFill.BackgroundColor3 = Theme.SidebarBg
	TopBarFill.BorderSizePixel = 0
	TopBarFill.Parent = TopBar
	
	-- Regenbogenteil oder Blau oben (Neverlose Style)
	local AccentLine = Instance.new("Frame")
	AccentLine.Size = UDim2.new(1, 0, 0, 2)
	AccentLine.BackgroundColor3 = Theme.Accent
	AccentLine.BorderSizePixel = 0
	AccentLine.Parent = TopBar
	
	local Title = Instance.new("TextLabel")
	Title.Text = hubName:upper() or "JOBWARE"
	Title.Size = UDim2.new(0.5, 0, 1, 0)
	Title.Position = UDim2.new(0.02, 0, 0, 0)
	Title.BackgroundTransparency = 1
	Title.Font = Theme.Font
	Title.TextSize = 16
	Title.TextColor3 = Theme.Text
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Parent = TopBar
	
	MakeDraggable(TopBar, MainFrame)

	-- SIDEBAR (Tabs)
	local Sidebar = Instance.new("Frame")
	Sidebar.Size = UDim2.new(0.25, 0, 1, -35)
	Sidebar.Position = UDim2.new(0, 0, 0, 35)
	Sidebar.BackgroundColor3 = Theme.SidebarBg
	Sidebar.BorderSizePixel = 0
	Sidebar.Parent = MainFrame
	
	-- Trennlinie Sidebar
	local SidebarLine = Instance.new("Frame")
	SidebarLine.Size = UDim2.new(0, 1, 1, 0)
	SidebarLine.Position = UDim2.new(1, 0, 0, 0)
	SidebarLine.BackgroundColor3 = Theme.Outline
	SidebarLine.BorderSizePixel = 0
	SidebarLine.Parent = Sidebar
	
	local TabContainer = Instance.new("ScrollingFrame")
	TabContainer.Size = UDim2.new(1, 0, 1, -10)
	TabContainer.Position = UDim2.new(0, 0, 0, 10)
	TabContainer.BackgroundTransparency = 1
	TabContainer.ScrollBarThickness = 0
	TabContainer.Parent = Sidebar
	
	local TabLayout = Instance.new("UIListLayout")
	TabLayout.Padding = UDim.new(0, 5)
	TabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	TabLayout.Parent = TabContainer

	-- CONTENT AREA
	local Content = Instance.new("Frame")
	Content.Size = UDim2.new(0.75, 0, 1, -35)
	Content.Position = UDim2.new(0.25, 0, 0, 35)
	Content.BackgroundTransparency = 1
	Content.Parent = MainFrame
	
	local Tabs = {}
	
	-- [[ TAB CREATION ]] --
	function Library:CreateTab(name, icon)
		local Tab = {}
		
		-- Tab Button
		local TabBtn = Instance.new("TextButton")
		TabBtn.Name = name.."_Btn"
		TabBtn.Size = UDim2.new(0.9, 0, 0, 40) -- Großer Touch Bereich
		TabBtn.BackgroundColor3 = Theme.SidebarBg
		TabBtn.BackgroundTransparency = 1
		TabBtn.Text = name
		TabBtn.Font = Theme.Font
		TabBtn.TextSize = 14
		TabBtn.TextColor3 = Theme.TextDark
		TabBtn.Parent = TabContainer
		
		-- Indikator Linie links (wenn aktiv)
		local ActiveLine = Instance.new("Frame")
		ActiveLine.Size = UDim2.new(0, 3, 0.6, 0)
		ActiveLine.Position = UDim2.new(0, 0, 0.2, 0)
		ActiveLine.BackgroundColor3 = Theme.Accent
		ActiveLine.BackgroundTransparency = 1 -- Start hidden
		ActiveLine.BorderSizePixel = 0
		ActiveLine.Parent = TabBtn
		AddCorner(ActiveLine, 2)
		
		-- Seite
		local Page = Instance.new("ScrollingFrame")
		Page.Name = name.."_Page"
		Page.Size = UDim2.new(1, 0, 1, 0)
		Page.BackgroundTransparency = 1
		Page.Visible = false
		Page.ScrollBarThickness = 2
		Page.ScrollBarImageColor3 = Theme.Accent
		Page.CanvasSize = UDim2.new(0,0,0,0)
		Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
		Page.Parent = Content
		
		local PageLayout = Instance.new("UIListLayout")
		PageLayout.Padding = UDim.new(0, 15)
		PageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
		PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
		PageLayout.Parent = Page
		
		local PagePad = Instance.new("UIPadding")
		PagePad.PaddingTop = UDim.new(0, 15)
		PagePad.PaddingBottom = UDim.new(0, 15)
		PagePad.Parent = Page
		
		-- Logic
		TabBtn.MouseButton1Click:Connect(function()
			-- Reset all
			for _, t in pairs(Tabs) do
				t.Page.Visible = false
				TweenService:Create(t.Btn, TweenInfo.new(0.2), {TextColor3 = Theme.TextDark}):Play()
				TweenService:Create(t.Line, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
			end
			-- Active
			Page.Visible = true
			TweenService:Create(TabBtn, TweenInfo.new(0.2), {TextColor3 = Theme.Text}):Play()
			TweenService:Create(ActiveLine, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
		end)
		
		table.insert(Tabs, {Btn = TabBtn, Page = Page, Line = ActiveLine})
		
		-- Wenn es der erste Tab ist, aktivieren wir ihn direkt
		if #Tabs == 1 then
			Page.Visible = true
			TabBtn.TextColor3 = Theme.Text
			ActiveLine.BackgroundTransparency = 0
		end
		
		-- [[ SECTIONS ]] --
		function Tab:CreateSection(secName)
			local Section = {}
			
			local SecFrame = Instance.new("Frame")
			SecFrame.Size = UDim2.new(0.95, 0, 0, 0) -- Auto Y
			SecFrame.BackgroundColor3 = Theme.SectionBg
			SecFrame.AutomaticSize = Enum.AutomaticSize.Y
			SecFrame.Parent = Page
			AddCorner(SecFrame, 5)
			AddStroke(SecFrame, Theme.Outline, 1)
			
			-- Header
			local Header = Instance.new("Frame")
			Header.Size = UDim2.new(1, 0, 0, 30)
			Header.BackgroundTransparency = 1
			Header.Parent = SecFrame
			
			local Title = Instance.new("TextLabel")
			Title.Text = secName
			Title.Size = UDim2.new(1, -20, 1, 0)
			Title.Position = UDim2.new(0, 10, 0, 0)
			Title.BackgroundTransparency = 1
			Title.Font = Theme.Font
			Title.TextSize = 13
			Title.TextColor3 = Theme.Accent
			Title.TextXAlignment = Enum.TextXAlignment.Left
			Title.Parent = Header
			
			-- Trennlinie unter Header
			local Sep = Instance.new("Frame")
			Sep.Size = UDim2.new(1, 0, 0, 1)
			Sep.Position = UDim2.new(0, 0, 1, -1)
			Sep.BackgroundColor3 = Theme.Outline
			Sep.BorderSizePixel = 0
			Sep.Parent = Header
			
			-- Container für Elemente
			local Items = Instance.new("Frame")
			Items.Size = UDim2.new(1, 0, 0, 0)
			Items.Position = UDim2.new(0, 0, 0, 30)
			Items.BackgroundTransparency = 1
			Items.AutomaticSize = Enum.AutomaticSize.Y
			Items.Parent = SecFrame
			
			local ItemLayout = Instance.new("UIListLayout")
			ItemLayout.Padding = UDim.new(0, 8)
			ItemLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
			ItemLayout.SortOrder = Enum.SortOrder.LayoutOrder
			ItemLayout.Parent = Items
			
			local ItemPad = Instance.new("UIPadding")
			ItemPad.PaddingTop = UDim.new(0, 10)
			ItemPad.PaddingBottom = UDim.new(0, 10)
			ItemPad.Parent = Items
			
			-- [[ ELEMENT: BUTTON ]]
			function Section:AddButton(text, callback)
				local Button = Instance.new("TextButton")
				Button.Size = UDim2.new(0.92, 0, 0, 38) -- Schön groß für Daumen
				Button.BackgroundColor3 = Theme.ElementBg
				Button.Text = text
				Button.TextColor3 = Theme.Text
				Button.Font = Theme.Font
				Button.TextSize = 13
				Button.Parent = Items
				AddCorner(Button, 4)
				AddStroke(Button, Theme.Outline, 1)
				
				Button.MouseButton1Click:Connect(function()
					TweenService:Create(Button, TweenInfo.new(0.1), {BackgroundColor3 = Theme.Accent}):Play()
					task.wait(0.1)
					TweenService:Create(Button, TweenInfo.new(0.2), {BackgroundColor3 = Theme.ElementBg}):Play()
					pcall(callback)
				end)
			end
			
			-- [[ ELEMENT: TOGGLE (Neverlose Style) ]]
			function Section:AddToggle(text, default, callback)
				local Toggled = default or false
				
				local Container = Instance.new("TextButton")
				Container.Size = UDim2.new(0.92, 0, 0, 38)
				Container.BackgroundColor3 = Theme.SectionBg -- Transparent wirkend
				Container.BackgroundTransparency = 1
				Container.Text = ""
				Container.AutoButtonColor = false
				Container.Parent = Items
				
				local Label = Instance.new("TextLabel")
				Label.Text = text
				Label.Size = UDim2.new(0.7, 0, 1, 0)
				Label.Position = UDim2.new(0, 0, 0, 0)
				Label.BackgroundTransparency = 1
				Label.TextColor3 = Theme.Text
				Label.Font = Theme.Font
				Label.TextSize = 13
				Label.TextXAlignment = Enum.TextXAlignment.Left
				Label.Parent = Container
				
				-- Checkbox/Switch Background
				local Switch = Instance.new("Frame")
				Switch.Size = UDim2.new(0, 42, 0, 20)
				Switch.Position = UDim2.new(1, -42, 0.5, -10)
				Switch.BackgroundColor3 = Toggled and Theme.Accent or Theme.ElementBg
				Switch.Parent = Container
				AddCorner(Switch, 10)
				AddStroke(Switch, Theme.Outline, 1)
				
				-- Dot
				local Dot = Instance.new("Frame")
				Dot.Size = UDim2.new(0, 16, 0, 16)
				Dot.Position = Toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
				Dot.BackgroundColor3 = Theme.Text
				Dot.Parent = Switch
				AddCorner(Dot, 8)
				
				Container.MouseButton1Click:Connect(function()
					Toggled = not Toggled
					local goalPos = Toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
					local goalCol = Toggled and Theme.Accent or Theme.ElementBg
					
					TweenService:Create(Dot, TweenInfo.new(0.2), {Position = goalPos}):Play()
					TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = goalCol}):Play()
					
					pcall(callback, Toggled)
				end)
			end
			
			-- [[ ELEMENT: SLIDER ]]
			function Section:AddSlider(text, min, max, default, callback)
				local val = default or min
				local dragging = false
				
				local Container = Instance.new("Frame")
				Container.Size = UDim2.new(0.92, 0, 0, 50)
				Container.BackgroundTransparency = 1
				Container.Parent = Items
				
				local Label = Instance.new("TextLabel")
				Label.Text = text
				Label.Size = UDim2.new(1, 0, 0, 20)
				Label.BackgroundTransparency = 1
				Label.TextColor3 = Theme.Text
				Label.Font = Theme.Font
				Label.TextSize = 13
				Label.TextXAlignment = Enum.TextXAlignment.Left
				Label.Parent = Container
				
				local ValLabel = Instance.new("TextLabel")
				ValLabel.Text = tostring(val)
				ValLabel.Size = UDim2.new(1, 0, 0, 20)
				ValLabel.BackgroundTransparency = 1
				ValLabel.TextColor3 = Theme.Accent
				ValLabel.Font = Theme.Font
				ValLabel.TextSize = 13
				ValLabel.TextXAlignment = Enum.TextXAlignment.Right
				ValLabel.Parent = Container
				
				local BarBg = Instance.new("TextButton") -- Zum Klicken
				BarBg.Size = UDim2.new(1, 0, 0, 8)
				BarBg.Position = UDim2.new(0, 0, 0, 25)
				BarBg.BackgroundColor3 = Theme.ElementBg
				BarBg.Text = ""
				BarBg.AutoButtonColor = false
				BarBg.Parent = Container
				AddCorner(BarBg, 4)
				
				local BarFill = Instance.new("Frame")
				BarFill.Size = UDim2.new((val - min) / (max - min), 0, 1, 0)
				BarFill.BackgroundColor3 = Theme.Accent
				BarFill.BorderSizePixel = 0
				BarFill.Parent = BarBg
				AddCorner(BarFill, 4)
				
				local function Update(input)
					local scale = math.clamp((input.Position.X - BarBg.AbsolutePosition.X) / BarBg.AbsoluteSize.X, 0, 1)
					local newVal = math.floor(min + ((max - min) * scale))
					
					TweenService:Create(BarFill, TweenInfo.new(0.05), {Size = UDim2.new(scale, 0, 1, 0)}):Play()
					ValLabel.Text = tostring(newVal)
					pcall(callback, newVal)
				end
				
				BarBg.InputBegan:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						dragging = true
						Update(input)
					end
				end)
				
				UserInputService.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						dragging = false
					end
				end)
				
				UserInputService.InputChanged:Connect(function(input)
					if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
						Update(input)
					end
				end)
			end
			
			return Section
		end
		
		return Tab
	end
	
	return Library
end

return JobwareLib

